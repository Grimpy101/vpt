#!/usr/bin/env node

const express = require('express');
const fs = require('fs');
const app = express();

app.set('port', process.env.PORT || 3000);

app.use(express.json({limit: '10mb'}));

app.use(express.urlencoded({
    extended: true
}));

app.use('/', express.static('build'));
app.use('/demos', express.static('demos'));

app.get('/', (req, res) => {
    res.sendFile('index.html', {root: 'build'});
});

app.get('/thanks', (req, res) => {
    res.sendFile('thanks.html', {root: 'build'});
});

app.get('demo-volumes.json', (req, res) => {
    res.sendFile('demo-volumes.json', {root: 'build'});
});

app.post('/store', (req, res) => {
    const data = req.body;
    const name = data.name;
    const today = new Date().toISOString();
    const fileName = "data/" + name + "_" + today + ".json";
    fs.writeFileSync(fileName, JSON.stringify(data));
    res.status(200).end();
});

app.listen(app.get('port'), function () {
    console.log('Listening on port ' + app.get('port'));
});
